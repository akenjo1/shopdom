rules_version = '2';
service cloud.firestore {
match /databases/{database}/documents {
// Hàm kiểm tra quyền
function isAdmin() {
return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
}
function isOwner(userId) {
return request.auth.uid == userId;
}

// USERS: Ai cũng tạo được (đăng ký), chỉ chủ nhân/admin đọc/sửa
match /users/{userId} {
  allow create: if true;
  allow read: if isOwner(userId) || isAdmin();
  allow update: if isAdmin(); // Chỉ admin mới được sửa số dư ví tiền
}

// PRODUCTS: Ai cũng đọc được, chỉ Admin sửa
match /products/{productId} {
  allow read: if true;
  allow write: if isAdmin();
}

// ORDERS: Chỉ đọc/tạo đơn của chính mình
match /orders/{orderId} {
  allow read: if isOwner(resource.data.userId) || isAdmin();
  allow create: if isOwner(request.resource.data.userId);
}

// TRANSACTIONS
match /transactions/{txnId} {
  allow read: if isOwner(resource.data.userId) || isAdmin();
  allow create: if isOwner(request.resource.data.userId);
}

// NOTIFICATIONS
match /notifications/{noteId} {
    allow read: if true;
    allow write: if isAdmin();
}


}
}
